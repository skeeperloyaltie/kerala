<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Kerala | Appointments</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="assets/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="assets/vendors/ti-icons/css/themify-icons.css">
    <link rel="stylesheet" href="assets/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="assets/vendors/font-awesome/css/font-awesome.min.css">
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.css">
    <!-- Layout styles -->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="shortcut icon" href="assets/images/favicon.png" />
    <!-- Additional CSS for custom styling -->
    <style>
        .filter-container { margin-bottom: 20px; }
        #appointmentFilter, #statusFilter, #dateFilter { width: 100%; padding: 10px; margin-bottom: 10px; }
        #appointmentsTable { width: 100%; border-collapse: collapse; }
        #appointmentsTable th, #appointmentsTable td { padding: 10px; text-align: left; }
        #appointmentsTable th { background-color: #007bff; color: white; }
        #appointmentsTable tr:nth-child(even) { background-color: #f8f9fa; }
        #appointmentsTable tr:hover { background-color: #e9ecef; }
        .btn-sm { margin: 2px; }
        .modal-body table { width: 100%; }
        .modal-body th, .modal-body td { padding: 8px; }
    </style>
    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
</head>
<body>
    <div class="container-scroller">
        <!-- Banner -->
        <div class="row p-0 m-0 proBanner" id="proBanner">
            <div class="col-md-12 p-0 m-0">
                <div class="card-body card-body-padding d-flex align-items-center justify-content-between">
                    <div class="ps-lg-3">
                        <p class="mb-0 font-weight-medium me-3 buy-now-text">Free 24/7 customer support, updates</p>
                        <a href="" target="_blank" class="btn me-2 buy-now-btn border-0">Book Appointment</a>
                    </div>
                    <div class="d-flex align-items-center justify-content-between">
                        <a href=""><i class="mdi mdi-home me-3 text-white"></i></a>
                        <button id="bannerClose" class="btn border-0 p-0">
                            <i class="mdi mdi-close text-white mr-0"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navbar -->
        <nav class="navbar default-layout-navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
            <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-start">
                <a class="navbar-brand brand-logo" href="index.html"><img src="assets/images/logo.png" alt="logo" height="190px"></a>
            </div>
            <div class="navbar-menu-wrapper d-flex align-items-stretch">
                <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
                    <span class="mdi mdi-menu"></span>
                </button>
                <div class="search-field d-none d-md-block">
                    <form class="d-flex align-items-center h-100" action="#">
                        <div class="input-group">
                            <div class="input-group-prepend bg-transparent">
                                <i class="input-group-text border-0 mdi mdi-magnify"></i>
                            </div>
                            <input type="text" class="form-control bg-transparent border-0" placeholder="Search patients, appointments">
                        </div>
                    </form>
                </div>
                <ul class="navbar-nav navbar-nav-right">
                    <li class="nav-item nav-profile dropdown">
                        <a class="nav-link dropdown-toggle" id="profileDropdown" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                            <div class="nav-profile-img">
                                <img src="assets/images/placeholder-doctor.jpg" alt="profile" id="doctor-profile-picture">
                                <span class="availability-status online"></span>
                            </div>
                            <div class="nav-profile-text">
                                <p class="mb-1 text-black" id="logged_in_user_name"></p>
                            </div>
                        </a>
                        <div class="dropdown-menu navbar-dropdown" aria-labelledby="profileDropdown">
                            <a class="dropdown-item" href="#">
                                <i class="mdi mdi-account-circle me-2 text-success"></i> My Profile </a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#" id="logoutButtonDropdown">
                                <i class="mdi mdi-logout me-2 text-primary"></i> Logout </a>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link count-indicator dropdown-toggle" id="messageDropdown" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="mdi mdi-email-outline"></i>
                            <span class="count-symbol bg-warning" id="message-count">3</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end navbar-dropdown preview-list" aria-labelledby="messageDropdown">
                            <h6 class="p-3 mb-0">Messages</h6>
                            <div id="message-list">
                                <p class="text-gray mb-0 text-center">No new messages</p>
                            </div>
                            <div class="dropdown-divider"></div>
                            <h6 class="p-3 mb-0 text-center">See all messages</h6>
                        </div>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link count-indicator dropdown-toggle" id="notificationDropdown" href="#" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="mdi mdi-bell-outline"></i>
                            <span class="count-symbol bg-danger" id="notification-count">5</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-end navbar-dropdown preview-list" aria-labelledby="notificationDropdown">
                            <h6 class="p-3 mb-0">Notifications</h6>
                            <div id="notification-list">
                                <p class="text-gray mb-0 text-center">No new notifications</p>
                            </div>
                            <div class="dropdown-divider"></div>
                            <h6 class="p-3 mb-0 text-center">See all notifications</h6>
                        </div>
                    </li>
                    <li class="nav-item nav-logout d-none d-lg-block">
                        <button class="btn btn-outline-danger" id="logoutButton">Logout</button>
                    </li>
                </ul>
                <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
                    <span class="mdi mdi-menu"></span>
                </button>
            </div>
        </nav>

        <!-- Sidebar -->
        <div class="container-fluid page-body-wrapper">
            <nav class="sidebar sidebar-offcanvas" id="sidebar">
                <ul class="nav">
                    <li class="nav-item nav-profile">
                        <a href="#" class="nav-link">
                            <div class="nav-profile-image">
                                <img src="assets/images/faces/face1.jpg" alt="profile" />
                                <span class="login-status online"></span>
                            </div>
                            <div class="nav-profile-text d-flex flex-column">
                                <span class="font-weight-bold mb-2" id="sidebar_user_name"></span>
                                <span class="text-secondary text-small" id="sidebar_user_role"></span>
                            </div>
                            <i class="mdi mdi-stethoscope text-primary nav-profile-badge"></i>
                        </a>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="index.html"><span class="menu-title">Dashboard</span><i class="mdi mdi-home menu-icon"></i></a></li>
                    <li class="nav-item"><a class="nav-link" href="patients.html"><span class="menu-title">Patients</span><i class="mdi mdi-account-group menu-icon"></i></a></li>
                    <li class="nav-item active"><a class="nav-link" href="appointments.html"><span class="menu-title">Appointments</span><i class="mdi mdi-calendar-check menu-icon"></i></a></li>
                    <li class="nav-item">
                        <a class="nav-link" data-bs-toggle="collapse" href="#medical-records" aria-expanded="false" aria-controls="medical-records">
                            <span class="menu-title">Medical Records</span><i class="menu-arrow"></i><i class="mdi mdi-folder-multiple menu-icon"></i>
                        </a>
                        <div class="collapse" id="medical-records">
                            <ul class="nav flex-column sub-menu">
                                <li class="nav-item"><a class="nav-link" href="records/view-records.html">View Records</a></li>
                                <li class="nav-item"><a class="nav-link" href="records/upload-records.html">Upload Records</a></li>
                            </ul>
                        </div>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="prescriptions.html"><span class="menu-title">Prescriptions</span><i class="mdi mdi-pill menu-icon"></i></a></li>
                    <li class="nav-item"><a class="nav-link" href="reports.html"><span class="menu-title">Reports</span><i class="mdi mdi-chart-bar menu-icon"></i></a></li>
                    <li class="nav-item"><a class="nav-link" href="lab-tests.html"><span class="menu-title">Lab Tests</span><i class="mdi mdi-flask-outline menu-icon"></i></a></li>
                    <li class="nav-item"><a class="nav-link" href="settings.html"><span class="menu-title">Settings</span><i class="mdi mdi-settings menu-icon"></i></a></li>
                </ul>
            </nav>

            <!-- Main Panel -->
            <div class="main-panel">
                <div class="content-wrapper">
                    <div class="page-header">
                        <h3 class="page-title">
                            <span class="page-title-icon bg-gradient W-primary text-white me-2">
                                <i class="mdi mdi-calendar-check"></i>
                            </span> Appointments
                        </h3>
                        <nav aria-label="breadcrumb">
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item active" aria-current="page">
                                    Welcome, <span id="welcome_user_name"></span> - Good <span id="timeOfDay"></span>
                                </li>
                            </ul>
                        </nav>
                    </div>

                    <div class="row">
                        <div class="col-md-12 grid-margin stretch-card">
                            <div class="card">
                                <div class="card-body">
                                    <h4 class="card-title">Appointment List</h4>
                                    <div class="filter-container">
                                        <input type="text" id="appointmentFilter" class="form-control" placeholder="Filter by patient name, doctor, status, or date...">
                                        <select id="statusFilter" class="form-control mt-2">
                                            <option value="">All Statuses</option>
                                            <option value="Scheduled">Scheduled</option>
                                            <option value="Active">Active</option>
                                            <option value="Completed">Completed</option>
                                            <option value="Canceled">Canceled</option>
                                            <option value="Rescheduled">Rescheduled</option>
                                            <option value="Waiting">Waiting</option>
                                            <option value="Pending">Pending</option>
                                        </select>
                                        <input type="date" id="dateFilter" class="form-control mt-2" placeholder="Filter by date">
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table" id="appointmentsTable">
                                            <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>Patient Name</th>
                                                    <th>Doctor</th>
                                                    <th>Date & Time</th>
                                                    <th>Status</th>
                                                    <th>Notes</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="appointmentsList"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <footer class="footer">
                    <div class="d-sm-flex justify-content-center justify-content-sm-between">
                        <span class="text-muted text-center text-sm-left d-block d-sm-inline-block">Copyright © 2025 <a href="https://www.kerala.com/" target="_blank">Kerala</a>. All rights reserved.</span>
                        <span class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">Doctors Dashboard <i class="mdi mdi-heart text-danger"></i></span>
                    </div>
                </footer>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="viewModal" tabindex="-1" aria-labelledby="viewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="viewModalLabel">Appointment Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="viewModalBody"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="editFromView">Edit</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editModalLabel">Edit Appointment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <div class="mb-3">
                            <label for="editNotes" class="form-label">Notes</label>
                            <input type="text" class="form-control" id="editNotes" name="notes">
                        </div>
                        <div class="mb-3">
                            <label for="editStatus" class="form-label">Status</label>
                            <select class="form-control" id="editStatus" name="status">
                                <option value="Scheduled">Scheduled</option>
                                <option value="Active">Active</option>
                                <option value="Completed">Completed</option>
                                <option value="Canceled">Canceled</option>
                                <option value="Rescheduled">Rescheduled</option>
                                <option value="Waiting">Waiting</option>
                                <option value="Pending">Pending</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="saveEdit">Save</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/vendors/js/vendor.bundle.base.js"></script>
    <script src="assets/vendors/bootstrap-datepicker/bootstrap-datepicker.min.js"></script>
    <script src="assets/js/off-canvas.js"></script>
    <script src="assets/js/misc.js"></script>
    <script src="assets/js/settings.js"></script>
    <script src="assets/js/todolist.js"></script>
    <script src="assets/js/jquery.cookie.js"></script>
    <script src="assets/js/dashboard.js"></script>

    <script>
        // Authentication Headers
        function getAuthHeaders() {
            const token = sessionStorage.getItem('token') || localStorage.getItem('token');
            const username = sessionStorage.getItem('username') || localStorage.getItem('username');
            const csrftoken = sessionStorage.getItem('csrftoken') || localStorage.getItem('csrftoken');
            return token && username && csrftoken ? {
                'Authorization': 'Token ' + token,
                'X-CSRFToken': csrftoken,
                'Username': username
            } : {};
        }

        // Session Check
        function checkSessionOnLoad() {
            const token = localStorage.getItem('token');
            const username = localStorage.getItem('username');
            const userType = localStorage.getItem('user_type');
            if (!token || !username || !userType) {
                console.warn('🔴 Session data missing. Redirecting...');
                window.location.href = 'http://smarthospitalmaintain.com';
                return;
            }
            validateUserSession();
        }

        // Validate Session
        function validateUserSession() {
            const headers = getAuthHeaders();
            if (!headers['Authorization']) {
                console.warn('🔴 No token. Redirecting...');
                window.location.href = 'http://smarthospitalmaintain.com';
                return;
            }
            $.ajax({
                url: 'http://smarthospitalmaintain.com:8000/cookie/check/',
                type: 'GET',
                headers: headers,
                success: function(response) {
                    if (response.message !== 'Cookie is valid.') {
                        console.warn('🔴 Invalid session. Logging out...');
                        logoutUser();
                        return;
                    }
                    const prefix = response.user_type === 'Doctor' ? 'Dr. ' : '';
                    const fullName = prefix + response.name;
                    $('#logged_in_user_name, #sidebar_user_name, #welcome_user_name').text(fullName);
                    $('#sidebar_user_role').text(response.user_type === 'Doctor' ? 'Doctor' : 'Receptionist');
                    $('#timeOfDay').text(getGreetingTime());
                    fetchAppointments(); // Load all appointments on page load
                },
                error: function(xhr) {
                    console.error('❌ Session validation error:', xhr.responseText);
                    logoutUser();
                }
            });
        }

        // Greeting Time
        function getGreetingTime() {
            const hours = new Date().getHours();
            return hours < 12 ? 'Morning' : hours < 18 ? 'Afternoon' : 'Evening';
        }

        // Logout
        function logoutUser() {
            const headers = getAuthHeaders();
            $.ajax({
                url: 'http://smarthospitalmaintain.com:8000/users/logout/',
                type: 'POST',
                headers: headers,
                success: function(response) {
                    console.log('✅ Logged out:', response);
                    sessionStorage.clear();
                    localStorage.clear();
                    document.cookie = "sessionid=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                    window.location.href = 'http://smarthospitalmaintain.com/';
                },
                error: function(xhr) {
                    console.error('❌ Logout error:', xhr.responseText);
                    Swal.fire('Error', 'Logout failed. Please try again.', 'error');
                }
            });
        }

        // Fetch Appointments
        let allAppointments = [];
        function fetchAppointments() {
            const headers = getAuthHeaders();
            $.ajax({
                url: 'http://smarthospitalmaintain.com:8000/appointments/list/',
                type: 'GET',
                headers: headers,
                success: function(response) {
                    console.log('✅ Appointments fetched:', response);
                    allAppointments = response.appointments || [];
                    populateAppointmentsTable(allAppointments);
                },
                error: function(xhr) {
                    console.error('❌ Fetch error:', xhr.responseText);
                    Swal.fire('Error', 'Failed to fetch appointments.', 'error');
                }
            });
        }

        // Populate Table
        function populateAppointmentsTable(appointments) {
            const tbody = $('#appointmentsList');
            tbody.empty();
            appointments.forEach((appt, index) => {
                const patientName = `${appt.patient.first_name} ${appt.patient.last_name || ''}`;
                const doctorName = appt.doctor ? `${appt.doctor.first_name} ${appt.doctor.last_name}` : 'N/A';
                const dateTime = new Date(appt.appointment_date).toLocaleString();
                tbody.append(`
                    <tr>
                        <td>${index + 1}</td>
                        <td>${patientName}</td>
                        <td>${doctorName}</td>
                        <td>${dateTime}</td>
                        <td>${appt.status}</td>
                        <td>${appt.notes || 'N/A'}</td>
                        <td>
                            <button class="btn btn-primary btn-sm" onclick="viewAppointment(${appt.id})">View</button>
                            <button class="btn btn-warning btn-sm" onclick="editAppointment(${appt.id})">Edit</button>
                            <button class="btn btn-danger btn-sm" onclick="cancelAppointment(${appt.id})">Cancel</button>
                            <button class="btn btn-info btn-sm" onclick="rescheduleAppointment(${appt.id})">Reschedule</button>
                        </td>
                    </tr>
                `);
            });
        }

        // Filter Appointments
        function filterAppointments() {
            const searchTerm = $('#appointmentFilter').val().toLowerCase();
            const statusFilter = $('#statusFilter').val();
            const dateFilter = $('#dateFilter').val();
            let filtered = allAppointments;

            if (searchTerm) {
                filtered = filtered.filter(appt =>
                    `${appt.patient.first_name} ${appt.patient.last_name || ''}`.toLowerCase().includes(searchTerm) ||
                    (appt.doctor && `${appt.doctor.first_name} ${appt.doctor.last_name}`.toLowerCase().includes(searchTerm)) ||
                    appt.status.toLowerCase().includes(searchTerm) ||
                    new Date(appt.appointment_date).toLocaleString().toLowerCase().includes(searchTerm)
                );
            }
            if (statusFilter) filtered = filtered.filter(appt => appt.status === statusFilter);
            if (dateFilter) {
                const filterDate = new Date(dateFilter);
                filtered = filtered.filter(appt => new Date(appt.appointment_date).toDateString() === filterDate.toDateString());
            }
            populateAppointmentsTable(filtered);
        }

        // View Appointment
        function viewAppointment(id) {
            const appt = allAppointments.find(a => a.id === id);
            if (!appt) return Swal.fire('Error', 'Appointment not found.', 'error');
            const patient = appt.patient;
            const doctor = appt.doctor || { first_name: 'N/A', last_name: '', specialization: 'N/A' };
            $('#viewModalBody').html(`
                <table class="table table-bordered">
                    <tr><th>Patient</th><td>${patient.first_name} ${patient.last_name || ''} (ID: ${patient.patient_id})</td></tr>
                    <tr><th>Doctor</th><td>${doctor.first_name} ${doctor.last_name} - ${doctor.specialization}</td></tr>
                    <tr><th>Date & Time</th><td>${new Date(appt.appointment_date).toLocaleString()}</td></tr>
                    <tr><th>Status</th><td>${appt.status}</td></tr>
                    <tr><th>Notes</th><td>${appt.notes || 'N/A'}</td></tr>
                    <tr><th>Emergency</th><td>${appt.is_emergency ? 'Yes' : 'No'}</td></tr>
                </table>
            `);
            $('#editFromView').off('click').on('click', function() {
                $('#viewModal').modal('hide');
                editAppointment(id);
            });
            $('#viewModal').modal('show');
        }

        // Edit Appointment
        function editAppointment(id) {
            const appt = allAppointments.find(a => a.id === id);
            if (!appt) return Swal.fire('Error', 'Appointment not found.', 'error');
            $('#editNotes').val(appt.notes || '');
            $('#editStatus').val(appt.status);
            $('#saveEdit').off('click').on('click', function() {
                const data = {
                    notes: $('#editNotes').val(),
                    status: $('#editStatus').val()
                };
                $.ajax({
                    url: `http://smarthospitalmaintain.com:8000/appointments/edit/${id}/`,
                    type: 'PATCH',
                    headers: getAuthHeaders(),
                    data: JSON.stringify(data),
                    contentType: 'application/json',
                    success: function(response) {
                        console.log('✅ Appointment updated:', response);
                        Swal.fire('Success', 'Appointment updated successfully.', 'success');
                        fetchAppointments();
                        $('#editModal').modal('hide');
                    },
                    error: function(xhr) {
                        console.error('❌ Edit error:', xhr.responseText);
                        Swal.fire('Error', 'Failed to update appointment.', 'error');
                    }
                });
            });
            $('#editModal').modal('show');
        }

        // Cancel Appointment
        function cancelAppointment(id) {
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, cancel it!'
            }).then(result => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: `http://smarthospitalmaintain.com:8000/appointments/cancel/${id}/`,
                        type: 'PATCH',
                        headers: getAuthHeaders(),
                        data: JSON.stringify({ status: 'Canceled' }),
                        contentType: 'application/json',
                        success: function(response) {
                            console.log('✅ Appointment canceled:', response);
                            Swal.fire('Canceled', 'Appointment has been canceled.', 'success');
                            fetchAppointments();
                        },
                        error: function(xhr) {
                            console.error('❌ Cancel error:', xhr.responseText);
                            Swal.fire('Error', 'Failed to cancel appointment.', 'error');
                        }
                    });
                }
            });
        }

        // Reschedule Appointment
        function rescheduleAppointment(id) {
            Swal.fire({
                title: 'Reschedule Appointment',
                html: `
                    <input type="datetime-local" id="newDate" class="swal2-input" value="${new Date().toISOString().slice(0, 16)}">
                    <select id="newStatus" class="swal2-select mt-2">
                        <option value="Rescheduled">Rescheduled</option>
                        <option value="Scheduled">Scheduled</option>
                    </select>
                `,
                showCancelButton: true,
                confirmButtonText: 'Reschedule',
                preConfirm: () => {
                    const newDate = $('#newDate').val();
                    if (!newDate) return Swal.showValidationMessage('Please select a date.');
                    return { appointment_date: newDate, status: $('#newStatus').val() };
                }
            }).then(result => {
                if (result.isConfirmed) {
                    $.ajax({
                        url: `http://smarthospitalmaintain.com:8000/appointments/reschedule/${id}/`,
                        type: 'PATCH',
                        headers: getAuthHeaders(),
                        data: JSON.stringify(result.value),
                        contentType: 'application/json',
                        success: function(response) {
                            console.log('✅ Appointment rescheduled:', response);
                            Swal.fire('Success', 'Appointment rescheduled successfully.', 'success');
                            fetchAppointments();
                        },
                        error: function(xhr) {
                            console.error('❌ Reschedule error:', xhr.responseText);
                            Swal.fire('Error', 'Failed to reschedule appointment.', 'error');
                        }
                    });
                }
            });
        }

        // Event Listeners
        $(document).ready(function() {
            checkSessionOnLoad();
            $('#appointmentFilter').on('input', filterAppointments);
            $('#statusFilter, #dateFilter').on('change', filterAppointments);
            $('#logoutButton, #logoutButtonDropdown').on('click', logoutUser);
        });
    </script>
</body>
</html>